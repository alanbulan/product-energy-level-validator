# 🔍 产品能效等级验证系统

一个智能化的产品能效等级数据验证工具，通过对比Excel数据与官方网站数据，自动检测数据准确性。

## ✨ 功能特点

### 🎯 核心功能
- **自动数据验证** - 批量验证Excel中的产品能效等级数据
- **智能型号识别** - 自动提取和标准化产品型号
- **官方数据对比** - 与权威网站数据进行实时对比
- **详细验证报告** - 生成包含统计分析的Excel验证报告

### 🔧 高级特性
- **版本后缀处理** - 正确处理"x2pro上下版"、"x2pro水箱版"等带版本的型号
- **时间筛选逻辑** - 同一型号多条记录时，自动选择公告时间最新的数据
- **相关性检查** - 二次验证，过滤不相关的匹配结果
- **Excel缺失检测** - 识别Excel中缺失能效数据但网站有数据的情况
- **反爬虫机制** - 内置请求频率控制和User-Agent轮换

### 📊 验证结果类型
- **✅ 正确** - Excel和网站数据一致
- **❌ 错误** - Excel和网站数据不一致（且产品相关）
- **📋 Excel缺失** - Excel无能效数据，网站有数据
- **⚠️ 搜不到** - 网站无数据或产品不相关

## 🚀 快速开始

### 1. 安装依赖
```bash
# 使用国内镜像源（推荐）
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# 或者使用其他镜像源
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
```

### 2. 准备Excel文件
确保Excel文件包含以下列：
- `产品型号` - 产品的完整型号
- `能耗级别\n（一级/二级）` - 产品的能效等级

### 3. 运行验证
```bash
python main_fast.py "你的Excel文件.xlsx"
```

## 📁 项目结构

```
📂 产品能效等级验证系统/
├── 🚀 main_fast.py              # 主程序入口
├── 🕷️ anti_crawler.py           # 反爬虫核心模块
├── 📊 excel_handler.py          # Excel文件处理
├── ⚡ fast_batch_processor.py   # 批量处理引擎
├── 🔧 model_extractor.py        # 智能型号提取
├── 🎯 result_comparator.py      # 结果对比分析
├── 🔍 relevance_checker.py      # 产品相关性检查
├── 📋 requirements.txt          # 依赖包列表
├── 📝 安装依赖包.txt             # 详细安装说明
└── 📖 README.md                 # 项目文档
```

## 🔧 核心模块说明

### 🚀 main_fast.py - 主程序
- 程序入口，协调各个模块工作
- 支持命令行参数配置
- 集成二次验证和相关性检查

### 🕷️ anti_crawler.py - 反爬虫模块
- 智能请求频率控制
- User-Agent随机轮换
- 网络异常处理和重试机制
- 数据提取和标准化

### 🔧 model_extractor.py - 型号提取器
- 智能识别产品品牌前缀
- 版本后缀保护（如"上下版"、"水箱版"）
- 支持多种型号格式
- 针对数据特点优化的提取算法

### 🎯 result_comparator.py - 结果对比器
- 能效等级标准化
- 多种对比逻辑
- Excel缺失数据检测
- 详细结果分类

### 🔍 relevance_checker.py - 相关性检查器
- 产品类型识别
- 品牌信息匹配
- 汉字相似度计算
- 二次验证逻辑

## 📊 使用示例

### 基本使用
```bash
# 验证所有数据
python main_fast.py "产品数据.xlsx"
```

### 高级参数
```bash
# 限制处理数量（测试用）
python main_fast.py "产品数据.xlsx" 100

# 自定义并发和延时
python main_fast.py "产品数据.xlsx" 1000 2 3.0
```

### 参数说明
- **参数1**: Excel文件路径（必需）
- **参数2**: 最大处理数量（可选，默认全部）
- **参数3**: 并发线程数（可选，默认3，建议1-5）
- **参数4**: 请求间隔秒数（可选，默认2.0，建议2.0以上）

## 📈 验证流程

### 1️⃣ 数据读取
- 从Excel文件读取产品型号和能效等级
- 自动识别列名格式
- 数据预处理和清洗

### 2️⃣ 型号提取
- 智能去除品牌前缀（格力、美的、海尔等）
- 保护版本后缀（上下版、水箱版、pro等）
- 标准化型号格式

### 3️⃣ 网络搜索
- 使用提取后的型号搜索官方数据
- 反爬虫保护，控制请求频率
- 异常处理和自动重试

### 4️⃣ 时间筛选
- 同一型号多条记录时，选择公告时间最新的
- 确保使用最新的官方数据

### 5️⃣ 相关性检查
- 二次验证，检查匹配产品的相关性
- 过滤不相关的错误匹配
- 提高验证准确性

### 6️⃣ 结果对比
- 标准化能效等级格式
- 多维度对比分析
- 生成详细验证报告

## 📋 输出结果

### Excel验证报告
系统会生成包含以下信息的Excel文件：
- **产品型号** - 原始产品型号
- **Excel能效等级** - Excel中的能效数据
- **验证结果** - 验证状态（正确/错误/Excel缺失/搜不到）
- **详细信息** - 具体的验证详情
- **匹配型号** - 网站匹配到的产品型号
- **网站能效等级** - 官方网站的能效数据

### 统计报告
- **总体统计** - 验证数量和成功率
- **结果分布** - 各类结果的数量和占比
- **准确率分析** - 数据质量评估
- **处理时间** - 验证耗时统计

## 🎯 智能特性详解

### 版本后缀处理
系统能正确处理以下类型的产品型号：
```
x2pro上下版 → 保持完整，不删除"上下版"
x2pro水箱版 → 保持完整，不删除"水箱版"
格力x2pro上下版 → 去掉"格力"，保留"x2pro上下版"
小米净化器3pro → 去掉"小米"，保留"净化器3pro"
```

### 时间筛选逻辑
当搜索到同一型号的多条记录时：
```
产品型号: 3259
记录1: 2024-05-06 - 能效等级2
记录2: 2024-08-31 - 能效等级2
记录3: 2024-09-10 - 能效等级3 ← 自动选择最新
```

### 相关性检查
防止不相关产品的错误匹配：
```
原始: 米家无线吸尘器2
错误匹配: 电脑椅2017版
系统判断: 产品类型不匹配 → 改为"搜不到"
```

## ⚙️ 技术规格

### 系统要求
- **Python版本**: 3.7+
- **操作系统**: Windows/Linux/macOS
- **内存要求**: 建议2GB以上
- **网络要求**: 稳定的互联网连接

### 依赖包
```
requests>=2.28.0    # HTTP请求库
pandas>=1.5.0       # 数据处理库
openpyxl>=3.0.10    # Excel文件处理
```

### 性能参数
- **处理速度**: 约2-3秒/条记录（含网络请求）
- **并发支持**: 1-5个线程（推荐2-3个）
- **内存占用**: 约50-100MB（取决于数据量）
- **准确率**: 96%+（基于实际测试数据）

## ⚠️ 注意事项

### 使用建议
1. **首次使用** - 建议先用少量数据测试（如50条）
2. **网络稳定** - 确保网络连接稳定，避免频繁中断
3. **合理并发** - 不要设置过高的并发数，避免被网站限制
4. **数据备份** - 验证前请备份原始Excel文件

### 常见问题
1. **网络超时** - 增加请求间隔时间，减少并发数
2. **验证失败** - 检查Excel文件格式和列名
3. **结果异常** - 查看详细日志，确认网络连接
4. **速度较慢** - 正常现象，网络请求需要时间

### Excel文件要求
- **文件格式**: .xlsx格式
- **必需列名**:
  - `产品型号` - 包含完整的产品型号
  - `能耗级别\n（一级/二级）` - 包含能效等级信息
- **数据格式**:
  - 型号：文本格式，支持中英文混合
  - 能效：一级/二级/三级/四级/五级 或 1/2/3/4/5

## 🔄 更新日志

### v2.0.0 (2025-01-18)
- ✨ 新增版本后缀处理功能
- ✨ 新增时间筛选逻辑
- ✨ 新增产品相关性检查
- ✨ 新增Excel缺失数据检测
- 🔧 优化型号提取算法
- 🔧 改进反爬虫机制
- 📊 增强统计报告功能

### v1.0.0 (2025-01-17)
- 🎉 初始版本发布
- ✅ 基础验证功能
- ✅ Excel数据处理
- ✅ 批量处理支持

## 📞 技术支持

如有问题或建议，请通过以下方式联系：
- 📧 邮箱: [技术支持邮箱]
- 💬 微信: [技术支持微信]
- 📱 电话: [技术支持电话]

---

**© 2025 产品能效等级验证系统 - 让数据验证更智能、更准确！** 🎯

## 📈 验证结果
- **正确**: Excel能效等级与网站数据一致
- **错误**: Excel能效等级与网站数据不一致
- **搜不到**: 网站无该产品数据

## ⚡ 系统特点
- 突破反爬虫机制
- 多线程并发处理
- 智能型号匹配
- 自动结果保存
